{% extends "base.html" %}

{% block title %}Home{% endblock %}

{% block content %}
<div class="hero-wrapper">
  <div class="top-section">
    <div class="top-actions">
      <a href="{{ url_for('register') }}" class="btn btn-register">+ New Memo</a>

      {% if current_user.is_authenticated %}
        <!-- ✅ アカウント管理ボタン -->
        <a href="{{ url_for('profile') }}" class="btn btn-profile">Account</a>

        <form action="{{ url_for('logout') }}" method="POST" class="logout-form">
          <button type="submit" class="btn btn-logout">Logout</button>
        </form>
      {% endif %}
    </div>
  </div>

  <div class="bottom-section">
    {% if memos %}
      {% for memo in memos %}
        <div class="card {% if memo.important %}important{% endif %}" data-id="{{ memo.id }}">
          <!-- ✅ カード全体をリンクにする -->
          <a href="{{ url_for('edit', memo_id=memo.id) }}" style="text-decoration: none; color: inherit;">
            <img src="{{ memo.image or 'https://i.postimg.cc/cCbHHdpW/landscape-5544380-1280.jpg' }}" alt="memo image">
            <h3>{{ memo.title[:30] }}{% if memo.title|length > 30 %}...{% endif %}</h3>
            <p>{{ memo.content[:100] }}{% if memo.content|length > 100 %}...{% endif %}</p>
            <small>{{ memo.created_at.strftime('%Y-%m-%d') }}</small>
          </a>
        </div>
      {% endfor %}
    {% else %}
      <p class="no-memo">Memo App<br>メモの投稿はありません</p>
    {% endif %}
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
<script>
document.addEventListener("DOMContentLoaded", () => {
  const container = document.querySelector(".bottom-section");
  if (container) {
    new Sortable(container, {
      animation: 300,
      easing: "cubic-bezier(0.25, 1, 0.5, 1)",
      ghostClass: 'dragging',
      // ✅ aタグはクリックできるようにする
      filter: "a",
      preventOnFilter: false,
    });
  }
});
</script>
{% endblock %}
